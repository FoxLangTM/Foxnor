<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoxNor | Minimalist YouTube Video Browser</title>

    <meta name="description" content="FoxNor: Stabilny i minimalistyczny odtwarzacz YouTube dla urządzeń low-end. Oglądaj filmy bez reklam, szybko i bezpiecznie w nowoczesnym designie.">
    <meta name="keywords" content="FoxNor, YouTube player, ad-free, fast performance, minimalist design, privacy player">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://foxnor.foxlang-team.workers.dev/">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://foxnor.foxlang-team.workers.dev/">
    <meta property="og:title" content="FoxNor | One of a kind; minimalist video browser">
    <meta property="og:description" content="Stabilny odtwarzacz wideo dla słabszych urządzeń. Brak reklam, pełna prywatność i świetny design.">
    <meta property="og:image" content="https://foxnor.foxlang-team.workers.dev/Images/FoxNor.png">
    <meta property="og:site_name" content="FoxNor Player">
    <meta name="theme-color" content="#32639b">

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="FoxNor | Minimalist Video Player">

    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">

    <link rel="icon" href="Images/favicon.ico" sizes="any">
    <link rel="apple-touch-icon" href="Images/FoxNor.png" fetchpriority="high" alt="FoxNor Logo">
    <link rel="manifest" href="/manifest.json">

    <link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" media="print" onload="this.media='all'">
    
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@700&family=Red+Hat+Display:wght@300;500&family=Saira:wght@700&display=swap" rel="stylesheet">

    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval'; script-src * 'unsafe-inline' 'unsafe-eval'; connect-src * 'unsafe-inline'; img-src * data:; style-src * 'unsafe-inline'; frame-src *;">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "FoxNor",
      "operatingSystem": "Android, Windows, iOS",
      "applicationCategory": "MultimediaApplication",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "description": "Minimalist ad-free video player for low-end devices."
    }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
</head>


<body>
<div id="player-cursor" class="player-custom-cursor"></div>

<div class="player-up-container" id="player-up-container">
<span>00:00:00</span></div>
<div class="player-up-container-btn" id="player-up-containe-btn"><i class="fa-solid fa-film" style="color: var(--player-dynamic-color); transform: translateY(9px);"></i></div>
<div class="player-container" id="player-foxnor-container" role="main">
    <header>
        <img src="https://raw.githubusercontent.com/FoxLangTM/LuxurySearchBar.Code/refs/heads/main/Images/foxnor2.png" alt="Logo" class="player-logo-img" fetchpriority="high">
        <span class="player-app-name">foxnor</span>
        <div id="player-search-title" class="player-video-title-box">⌕ Searching videos</div>
    </header>

    <div class="player-video-wrapper" id="player-v-wrapper">
        <div id="player-main-iframe"></div>

        <div class="player-gesture-zone" id="player-zone-left" style="z-index:20;"></div>
        <div class="player-gesture-zone" id="player-zone-right" style="z-index:20;"></div>
        
        <div id="player-brightness-overlay"></div>
        
        <div id="player-indicator" class="player-gesture-indicator">
            <i id="player-indicator-icon" class="fas fa-volume-up"></i>
            <div class="player-indicator-bar"><div id="player-indicator-fill" class="player-indicator-fill"></div></div>
        </div>

        <div class="player-controls-bar">
            <i class="fas fa-play" id="player-btn-play" style="color: var(--player-dynamic-color);" onclick="foxnorPlayer.togglePlay()" style="cursor:pointer"></i>
            <div class="player-progress-container" onclick="foxnorPlayer.seek(event)">
                <div class="player-progress-buffer" id="player-buffer-bar"></div>
                <div class="player-progress-fill" id="player-progress-bar"></div>
                <span id="player-time-remaining" style="position:absolute; right:10px; top:-18px; font-size:10px; color:#888; font-family:monospace;">-0:00</span>
            </div>
            <i class="fas fa-cog player-control-icon" style="color: #B3B3B3;"title="Ustawienia" onclick="alert('Not now...')"></i>
            <i class="fas fa-external-link-alt player-control-icon" style="color: #B3B3B3;" title="PiP Mode" onclick="foxnorPlayer.togglePiP()"></i>
            <i class="fas fa-expand player-control-icon" style="color: #B3B3B3; title="Pełny ekran" onclick="foxnorPlayer.toggleFullscreen()"></i>
        </div>
    </div>

    <div class="player-info-section">
        <div class="player-avatar-viz">
            <div id="player-dynamic-avatar" class="player-avatar"></div>
            <div class="player-spike-system" id="player-spike-system"></div>
        </div>
        <div class="player-content">
            <strong id="player-video-main-title" class="player-video-real-title">...</strong>
            <button class="player-more-btn" onclick="foxnorPlayer.toggleDescription()">⌵ show more</button>
            <div id="dynamic-btn-container"></div>
        </div>
    </div>
</div>

<div class="player-down-container" id="player-down-container">
      <div class="drag-handle"></div>
                  <div id="player-video-desc" class="player-description-area">
Not now...            </div>
</div>

<img id="player-color-ref" crossorigin="anonymous" style="display:none">
<script>
// --- GLOBALNY OBIEKT "foxnorPlayer" (Namespace) ---
// Wszystkie funkcje i zmienne są teraz właściwościami tego obiektu
const foxnorPlayer = {
    // --- KONFIGURACJA ---
    config: {
        getVideoId: function() {
            const urlParams = new URLSearchParams(window.location.search);
            const proxyId = urlParams.get('proxy'); // Szuka parametru ?proxy=
            return proxyId ? proxyId : 'KDCOrufl7Is';
        },
        dom: {
            overlay: null,
            indicator: null,
            fill: null,
            icon: null,
            title: null
        }
    },
    
    // --- ZMIENNE STANU ---
    state: {
        ytInstance: null,
        rAF_ID: null,
        startY: 0,
        startVal: 0,
        currentBrightness: 0,
        lastTap: 0,
        hideTimeout: null,
        cursorTimeout: null,
        touchStartY: 0
    },

    // --- NARZĘDZIA ZEWNĘTRZNE ---
    tools: {
        colorThief: new ColorThief()
    },

    // --- INICJALIZACJA ---
    init: function() {
        // Cache DOM elements
        this.config.dom.overlay = document.getElementById('player-brightness-overlay');
        this.config.dom.indicator = document.getElementById('player-indicator');
        this.config.dom.fill = document.getElementById('player-indicator-fill');
        this.config.dom.icon = document.getElementById('player-indicator-icon');
        this.config.dom.title = document.getElementById('player-search-title');

        // Visibility API Listener
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                cancelAnimationFrame(this.state.rAF_ID);
                this.config.dom.title.innerText = `⌕ Foxnor - Background Mode Active`;
            } else {
                this.updateProgress();
                this.fetchOEmbed();
            }
        });

        // Setup Cursor
        this.setupCursor();
        
        // Setup Spikes
        this.createSpikes();

        // Setup Hover Title
        this.setupHoverTitle();
        
        // Setup Down Container Panel
        this.setupDownPanelGestures();
        
        // Setup Down Container Resize
        window.addEventListener('resize', () => this.adjustPanelHeight());
    },

    // --- LOGIKA YOUTUBE ---
    onYouTubeReady: function(e) {
    if (navigator.connection) {
        const speed = navigator.connection.downlink;
        if (speed < 2) {
            this.state.ytInstance.setPlaybackQuality('medium');
        } else {
            this.state.ytInstance.setPlaybackQuality('highres');
        }
    }
    
    const frame = e.target.getIframe();
    frame.removeAttribute('allow');
    frame.setAttribute('allow', 'autoplay; encrypted-media; picture-in-picture');
    frame.setAttribute('sandbox', 'allow-forms allow-scripts allow-pointer-lock allow-same-origin allow-presentation');
    frame.setAttribute('referrerpolicy', 'no-referrer-when-downgrade');
    
    this.fetchOEmbed(); 
    this.updateProgress();
    this.setupGestures(); 
},

    onPlayerStateChange: function(event) {
        const playBtn = document.getElementById('player-btn-play');
        const avatar = document.getElementById('player-dynamic-avatar');

        if (event.data === 1) { // PLAYING
            playBtn.className = 'fas fa-pause';
            avatar.classList.add('player-playing');
            if ('mediaSession' in navigator) navigator.mediaSession.playbackState = "playing";
        } else if (event.data === 2) { // PAUSED
            playBtn.className = 'fas fa-play';
            avatar.classList.remove('player-playing');
            if ('mediaSession' in navigator) navigator.mediaSession.playbackState = "paused";
        }
    },

    // --- STEROWANIE ---
    togglePlay: function() {
        const icon = document.createElement('i');
        icon.style.cssText = "position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); font-size:50px; opacity:0.8; z-index:100; pointer-events:none; transition: all 0.5s;";
        
        if (this.state.ytInstance.getPlayerState() === 1) {
            this.state.ytInstance.pauseVideo();
            icon.className = 'fas fa-pause';
        } else {
            this.state.ytInstance.playVideo();
            icon.className = 'fas fa-play';
        }
        
        document.querySelector('.player-video-wrapper').appendChild(icon);
        setTimeout(() => { 
            icon.style.transform = "translate(-50%, -50%) scale(1.5)"; 
            icon.style.opacity = "0"; 
            setTimeout(() => icon.remove(), 500);
        }, 10);
    },

    seek: function(event) {
        const rect = event.currentTarget.getBoundingClientRect();
        const pos = (event.clientX - rect.left) / rect.width;
        this.state.ytInstance.seekTo(pos * this.state.ytInstance.getDuration());
    },

    toggleFullscreen: function() {
        const elem = document.getElementById('player-foxnor-container');
        if (!document.fullscreenElement) elem.requestFullscreen();
        else document.exitFullscreen();
    },
    
    togglePiP: async function() {
    try {
        const videoWrapper = document.getElementById('player-v-wrapper');
        
        if (document.pictureInPictureElement) {
            await document.exitPictureInPicture();
        } else if (document.pictureInPictureEnabled) {
            // Uwaga: Niektóre przeglądarki wymagają tagu <video>. 
            // Jeśli iframe blokuje dostęp, wyświetlimy komunikat biznesowy.
            const video = document.querySelector('video'); 
            if (video) {
                await video.requestPictureInPicture();
            } else {
                alert("PiP jest ograniczony przez politykę odtwarzacza zewnętrznego. Użyj trybu pełnoekranowego.");
            }
        }
    } catch (error) {
        console.error("Błąd PiP:", error);
    }
},

    toggleDescription: function() {
        const area = document.getElementById('player-video-desc');
        const downPanel = document.getElementById('player-down-container');
        const mainBtn = document.querySelector('.player-content .player-more-btn');
        const dynamicContainer = document.getElementById('dynamic-btn-container');
        
        // Przełączamy klasę aktywności opisu
        const isActive = area.classList.toggle('player-active');
        
        if (isActive) {
            // ROZWINIĘTE: Otwieramy też cały panel dolny, żeby opis był widoczny
            downPanel.classList.add('is-active');
            mainBtn.style.display = 'none'; // Chowamy "show more" pod tytułem
            
            // Wstrzykujemy "show less" do kontenera w górnej części
            dynamicContainer.innerHTML = `
                <button class="player-more-btn" onclick="foxnorPlayer.toggleDescription()">︽ show less</button>
            `;
        } else {
            // ZWINIĘTE: Zamykamy panel i przywracamy stan pierwotny
            downPanel.classList.remove('is-active');
            mainBtn.style.display = 'block';
            dynamicContainer.innerHTML = '';
            area.scrollTop = 0; // Ochrona wzroku
        }
    },

    // --- GESTY ---
    setupGestures: function() {
        const left = document.getElementById('player-zone-left');
        const right = document.getElementById('player-zone-right');

        const handleStart = (e, type) => {
            this.state.startY = e.touches[0].clientY;
            this.state.startVal = (type === 'volume') ? this.state.ytInstance.getVolume() : this.state.currentBrightness;
        };

        const handleMove = (e, type) => {
            const deltaY = this.state.startY - e.touches[0].clientY;
            this.config.dom.indicator.style.display = 'flex';

            if (type === 'volume') {
                let newVal = Math.min(100, Math.max(0, this.state.startVal + deltaY * 0.4));
                this.state.ytInstance.setVolume(newVal);
                
                if (newVal === 0) this.config.dom.icon.className = 'fas fa-volume-mute';
                else if (newVal < 30) this.config.dom.icon.className = 'fas fa-volume-off';
                else if (newVal < 70) this.config.dom.icon.className = 'fas fa-volume-down';
                else this.config.dom.icon.className = 'fas fa-volume-up';
                
                this.config.dom.fill.style.width = newVal + '%';
            } 
            else if (type === 'bright') {
                let brightnessScale = Math.min(0.9, Math.max(0, this.state.startVal - deltaY * 0.005));
                document.getElementById('player-brightness-overlay').style.opacity = brightnessScale;
                
                this.config.dom.icon.className = brightnessScale > 0.5 ? 'fas fa-moon' : 'fas fa-sun';
                this.config.dom.fill.style.width = (100 - (brightnessScale * 100)) + '%';
            }
        };

        left.addEventListener('touchstart', (e) => handleStart(e, 'bright'));
        left.addEventListener('touchmove', (e) => { e.preventDefault(); handleMove(e, 'bright'); }, {passive: false});
        left.addEventListener('touchend', () => { 
            this.config.dom.indicator.style.display = 'none'; 
            this.state.currentBrightness = parseFloat(document.getElementById('player-brightness-overlay').style.opacity) || 0;
        });

        right.addEventListener('touchstart', (e) => handleStart(e, 'volume'));
        right.addEventListener('touchmove', (e) => { e.preventDefault(); handleMove(e, 'volume'); }, {passive: false});
        right.addEventListener('touchend', () => this.config.dom.indicator.style.display = 'none');

        // Tap to Seek Logic (Double Tap ish)
        document.querySelector('.player-video-wrapper').addEventListener('touchend', (e) => {
            const currentTime = new Date().getTime();
            const tapLength = currentTime - this.state.lastTap;
            if (tapLength < 300 && tapLength > 0) {
                const x = e.changedTouches[0].clientX;
                const width = window.innerWidth;
                if (x < width / 2) this.state.ytInstance.seekTo(this.state.ytInstance.getCurrentTime() - 12);
                else this.state.ytInstance.seekTo(this.state.ytInstance.getCurrentTime() + 12);
            }
            this.state.lastTap = currentTime;
        });
    },

    // --- POBIERANIE DANYCH ---
    fetchOEmbed: function() {
        fetch(`https://noembed.com/embed?url=https://www.youtube.com/watch?v=${this.config.videoId}`)
            .then(res => res.json())
            .then(data => {
                document.getElementById('player-video-main-title').innerText = data.title;
                this.config.dom.title.innerText = `⌕ ${data.author_name} • ${data.title}`;
                
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.metadata = new MediaMetadata({
                        title: data.title,
                        artist: data.author_name,
                        album: 'Foxnor Player',
                        artwork: [
                            { src: `https://img.youtube.com/vi/${this.config.videoId}/maxresdefault.jpg`, sizes: '1280x720', type: 'image/jpeg' },
                            { src: `https://img.youtube.com/vi/${this.config.videoId}/hqdefault.jpg`, sizes: '480x360', type: 'image/jpeg' }
                        ]
                    });
                    this.setupMediaActions();
                }
                
                setTimeout(() => {
                    const img = document.getElementById('player-color-ref');
                    img.crossOrigin = "Anonymous";
                    img.src = `https://img.youtube.com/vi/${this.config.videoId}/hqdefault.jpg`;
                    
                    img.onload = () => {
                        const color = this.tools.colorThief.getColor(img);
                        const r = color[0], g = color[1], b = color[2];
                        
                        const dynamicColor = `rgb(${r}, ${g}, ${b})`;
                        document.documentElement.style.setProperty('--player-dynamic-color', dynamicColor);
                        document.body.style.backgroundSize = "200% 200%";
                        
                        const avatarDiv = document.getElementById('player-dynamic-avatar');
                        if (avatarDiv) {
                            avatarDiv.style.borderColor = `rgb(${r}, ${g}, ${b})`;
                        }

                        const urlParts = data.author_url.split('/');
                        const handle = urlParts[urlParts.length - 1].replace('@', '');
                        const avatarImg = new Image();
                        avatarImg.src = `https://unavatar.io/youtube/${handle}`;
                        avatarImg.onload = () => {
                            avatarDiv.style.backgroundImage = `url('${avatarImg.src}')`;
                            avatarDiv.classList.add('player-loaded');
                        };
                    };
                }, 1000);
            })
            .catch(err => console.error("Player Business Error:", err));
    },

    setupMediaActions: function() {
        const actions = [
            ['play', () => { this.state.ytInstance.playVideo(); }],
            ['pause', () => { this.state.ytInstance.pauseVideo(); }],
            ['seekbackward', () => { this.state.ytInstance.seekTo(this.state.ytInstance.getCurrentTime() - 10); }],
            ['seekforward', () => { this.state.ytInstance.seekTo(this.state.ytInstance.getCurrentTime() + 10); }],
            ['stop', () => { this.state.ytInstance.stopVideo(); }]
        ];

        for (const [action, handler] of actions) {
            try { navigator.mediaSession.setActionHandler(action, handler); } catch (error) {}
        }
    },

    // --- UI/UX & ANIMACJE ---
    updateProgress: function() {
        if (this.state.ytInstance && typeof this.state.ytInstance.getPlayerState === 'function') {
            const state = this.state.ytInstance.getPlayerState();
            
            if (state === 1 && !document.hidden) {
                const duration = this.state.ytInstance.getDuration();
                const currentTime = this.state.ytInstance.getCurrentTime();
                
                if (duration > 0) {
                    const pct = (currentTime / duration) * 100;
                    document.getElementById('player-progress-bar').style.width = pct + '%';
                    
                const curMins = Math.floor(currentTime / 60);
                const curSecs = Math.floor(currentTime % 60);
                const durMins = Math.floor(duration / 60);
                const durSecs = Math.floor(duration % 60);
                    const remaining = Math.floor(duration - currentTime);
                    const mins = Math.floor(remaining / 60);
                    const secs = remaining % 60;
                  const timeStr = `-${mins}:${secs < 10 ? '0'+secs : secs}`;
                  const timeString = `${curMins}:${curSecs < 10 ? '0'+curSecs : curSecs} / ${durMins}:${durSecs < 10 ? '0'+durSecs : durSecs}`;
                
                const upContainer = document.querySelector('#player-up-container span');
                if (upContainer) upContainer.innerText = timeString;
                    
                    if (document.getElementById('player-time-remaining').innerText !== timeStr) {
                        document.getElementById('player-time-remaining').innerText = timeStr;
                    }

                    const buffer = document.getElementById('player-buffer-bar');
                    if(buffer) buffer.style.width = (this.state.ytInstance.getVideoLoadedFraction() * 100) + '%';
                }
            }
        }
        if (!document.hidden) {
            this.state.rAF_ID = requestAnimationFrame(() => this.updateProgress());
        }
    },

    createSpikes: function() {
        const system = document.getElementById('player-spike-system');
        if (!system) return;
        system.innerHTML = '';
        const count = 50;
        
        for (let i = 0; i < count; i++) {
            const spike = document.createElement('div');
            spike.className = 'player-spike';
            const angle = (i / count) * 360;
            spike.style.setProperty('--hue', angle);
            spike.style.setProperty('--angle', `${angle}deg`);
            spike.style.animationDelay = `${Math.random() * 1}s`;
            system.appendChild(spike);
        }
    },

    setupCursor: function() {
        const cursor = document.getElementById('player-cursor');
        const wrapper = document.getElementById('player-v-wrapper');
        const controls = document.querySelector('.player-controls-bar');
        
        const showControls = () => {
            controls.style.opacity = '1';
            clearTimeout(this.state.hideTimeout);
            this.state.hideTimeout = setTimeout(() => {
                controls.style.opacity = '0';
            }, 2222);
        };

        const moveCursor = (clientX, clientY) => {
            cursor.style.opacity = '1';
            cursor.style.left = clientX + 'px';
            cursor.style.top = clientY + 'px';
            clearTimeout(this.state.cursorTimeout);
            this.state.cursorTimeout = setTimeout(() => {
                cursor.style.opacity = '0';
            }, 1770);
        };

        wrapper.addEventListener('mousemove', (e) => { moveCursor(e.clientX, e.clientY); showControls(); });
        wrapper.addEventListener('touchstart', (e) => {
            const t = e.touches[0]; moveCursor(t.clientX, t.clientY); showControls();
        }, { passive: true });
        wrapper.addEventListener('touchmove', (e) => {
            const t = e.touches[0]; moveCursor(t.clientX, t.clientY);
        }, { passive: true });

        // Gestures integration for cursor
        [document.getElementById('player-zone-left'), document.getElementById('player-zone-right')].forEach(zone => {
            zone.addEventListener('touchmove', (e) => {
                const t = e.touches[0]; moveCursor(t.clientX, t.clientY);
            }, { passive: true });
        });

        document.querySelectorAll('.player-control-icon, #player-btn-play, .player-more-btn').forEach(el => {
            el.addEventListener('mouseenter', () => cursor.style.transform = 'translate(-50%, -50%) scale(4)');
            el.addEventListener('mouseleave', () => cursor.style.transform = 'translate(-50%, -50%) scale(1)');
        });
    },

    setupHoverTitle: function() {
        document.querySelector('.player-progress-container').addEventListener('mousemove', (e) => {
            const rect = e.currentTarget.getBoundingClientRect();
            const pos = (e.clientX - rect.left) / rect.width;
            const hoverTime = pos * this.state.ytInstance.getDuration();
            const mins = Math.floor(hoverTime / 60);
            const secs = Math.floor(hoverTime % 60);
            this.config.dom.title.innerText = `${mins}:${secs < 10 ? '0'+secs : secs}`;
        });

        document.querySelector('.player-progress-container').addEventListener('mouseleave', () => {
            this.fetchOEmbed();
        });
    },
   setupDownPanelGestures: function() {
        const downContainer = document.getElementById('player-down-container');
        if (!downContainer) return;

        // 1. GESTY PRZESUWANIA (GÓRA / DÓŁ)
        downContainer.addEventListener('touchstart', (e) => {
            this.state.touchStartY = e.touches[0].clientY;
        }, { passive: true });

        window.addEventListener('touchmove', (e) => {
            if (this.state.touchStartY === 0) return;

            const currentY = e.touches[0].clientY;
            const diff = this.state.touchStartY - currentY;

            // Otwieranie (ruch w górę)
            if (diff > 15) { 
                downContainer.classList.add('is-active');
                this.adjustPanelHeight();
                this.state.touchStartY = 0; 
            }
            // Zamykanie (ruch w dół - tylko jeśli panel jest otwarty)
            else if (diff < -15 && downContainer.classList.contains('is-active')) {
                downContainer.classList.remove('is-active');
                downContainer.style.height = '130px';
                this.state.touchStartY = 0;
            }
        }, { passive: true });

        window.addEventListener('touchend', () => {
            this.state.touchStartY = 0;
        });

        // 2. ZAMYKANIE PRZEZ KLIKNIĘCIE W TŁO / POZA PANEL
        window.addEventListener('touchstart', (e) => {
            // Sprawdzamy: czy panel jest otwarty ORAZ czy dotknięte miejsce NIE jest panelem
            if (downContainer.classList.contains('is-active') && !downContainer.contains(e.target)) {
                downContainer.classList.remove('is-active');
            }
        }, { passive: true });
    },
    
    adjustPanelHeight: function() {
        const downContainer = document.getElementById('player-down-container');
        if (!downContainer) return;

        if (downContainer.classList.contains('is-active')) {
            // Po prostu pozwalamy CSS-owi przejąć kontrolę nad wysokością 65.5vh
            downContainer.style.height = ''; 
        } else {
            downContainer.style.height = '130px';
        }
    },
};

// --- ŁADOWANIE API YOUTUBE (Globalny Callback) ---
var tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
document.head.appendChild(tag);

// NAPRAWIONY CALLBACK API
function onYouTubeIframeAPIReady() {
    foxnorPlayer.init(); 

    const currentId = foxnorPlayer.config.getVideoId();
    foxnorPlayer.config.videoId = currentId;

    foxnorPlayer.state.ytInstance = new YT.Player('player-main-iframe', {
        host: 'https://www.youtube-nocookie.com',
        videoId: currentId,
        playerVars: { 
            'controls': 0, 'fs': 0, 'modestbranding': 1, 'rel': 0, 
            'enablejsapi': 1, 'iv_load_policy': 3, 'disablekb': 1
        },
        events: { 
            'onReady': (e) => foxnorPlayer.onYouTubeReady(e),
            'onStateChange': (e) => foxnorPlayer.onPlayerStateChange(e)
        }
    });
}
</script>
</body>
</html>